## Watch Together — инструкции для AI-агентов

Коротко: это лёгкий prototype для «watch together» на Node + Express + Socket.IO. Сервер отдаёт статические файлы из `public/`, а синхронизация плеера идёт через Socket.IO комнатами (roomId).

Нужно знать, чтобы быть продуктивным:

- Главные файлы
  - `server.js` — HTTP сервер (Express) + Socket.IO. Слушает события сокетов и ретранслирует их по комнатам.
  - `package.json` — скрипт запуска: `npm start` -> `node server.js`.
  - `public/index.html` — основной UI (room, поле URL, плеер, чат). Подключает `client.js` и клиентский `socket.io`.
  - `public/client.js` — логика клиента: создание плеера (HTML5 video или YouTube iframe), детект YouTube, обработка событий плеера и отправка `player-event`.

- Большая картина и поток данных
  - Клиент отправляет на сервер события (например, при play/pause/seek) в виде: `{ roomId, type, data }` через событие `player-event`.
  - Сервер принимает `player-event` и делает `socket.to(roomId).emit('player-event', { type, data })` — т.е. ретрансляция всем участникам комнаты, кроме отправителя.
  - Для вступления в комнату клиент отправляет `join-room` с формой: `{ roomId }` и сервер вызывает `socket.join(roomId)`.

- Форма полезных сообщений (примеры)
  - join-room: `{ roomId: "romeo-juliet" }`
  - player-event (play): `{ roomId: "romeo-juliet", type: "play", data: { time: 12.34 } }`
  - player-event (seek): `{ roomId: "romeo-juliet", type: "seek", data: { time: 120 } }`

- Про плееры
  - HTML5 video: реализованы слушатели `play`, `pause`, `seeking` и периодическое обновление времени (`setInterval` для UI `#time`). Видео элемент создаётся функцией `createVideoElement(url)`; у него `crossOrigin = 'anonymous'`.
  - YouTube: клиент создаёт iframe-embed (`createYouTubeIframe`). Текущая реализация использует postMessage к iframe (комментарии в коде). Для надёжного контроля YouTube потребуется подключить IFrame API и/или YT.Player (пока не реализовано).

- Конвенции и допущения, обнаруженные в коде
  - roomId — строка, произвольные человекочитаемые ключи (user-set in UI). Используется для socket.io rooms.
  - События плеера не содержат информации об авторе — приложение предполагает, что все участники доверяют ретрансляции на сервере.
  - Нет аутентификации/авторизации — все соединения публичны по roomId.

- Запуск и отладка (быстро)
  - Установите зависимости и запустите сервер:

```powershell
npm install
npm start
```

  - Откройте в браузере `http://localhost:3000` (или `PORT` из env). Для локальной отладки открывайте несколько вкладок/браузеров, чтобы наблюдать ретрансляцию сокетов.
  - Логи подключений/отключений и join выводятся в консоль сервера (`console.log` в `server.js`).

- Где вносить изменения / расширения
  - Добавлять новые синхронизируемые действия: обрабатывать их в `client.js` (emit при локальном действии) и в `server.js` ретранслировать тем же паттерном (`socket.on('player-event', ...)`).
  - Если нужна точная синхронизация YouTube, интегрировать YouTube IFrame API в `public/client.js` и заменить iframe с простым postMessage на `YT.Player`.

- Отличия от типичных проектов
  - Проект минималистичен: нет сборщиков/TS/тестов/CI. Код ориентирован на простоту и прототипирование — правки часто в `public/client.js` + `server.js`.
  - Формат сообщений и названия событий фиксированы в коде — см. `player-event` / `join-room`.

Если нужно — могу расширить файл, добавив: списки TODO (например, YT API integration), примеры тестов для Socket.IO, или шаблон для дополнительных событий (chat messages, presence). Напишите, какие разделы непонятны или требуют примеров — внесу правки.

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Socket.IO –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; }
        .success { border-left-color: #28a745; }
        button { padding: 10px 15px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üß™ –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç Socket.IO –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π</h1>

    <div class="log">
        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong> –û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –¥–≤—É—Ö –≤–∫–ª–∞–¥–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.<br>
        –í –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–µ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ".<br>
        –í–æ –≤—Ç–æ—Ä–æ–π –≤–∫–ª–∞–¥–∫–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ.
    </div>

    <button onclick="testInvitationSystem()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ</button>
    <button onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>

    <div id="logContainer"></div>

    <script src="socket.io/socket.io.js"></script>
    <script>
        let socket;
        let currentRoomId = 'simple-test-' + Date.now();
        let otherSocketId = null;

        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const logEntry = document.createElement('div');
            logEntry.className = 'log ' + type;
            logEntry.innerHTML = '<strong>[' + new Date().toLocaleTimeString() + ']</strong> ' + message;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function testInvitationSystem() {
            log('–ù–∞—á–∏–Ω–∞–µ–º —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π...');

            // –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
            socket = io('http://localhost:3000');

            socket.on('connect', () => {
                log('‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É! Socket ID: ' + socket.id, 'success');

                // –í—Ö–æ–¥–∏–º –≤ –∫–æ–º–Ω–∞—Ç—É
                socket.emit('join-room', {
                    roomId: currentRoomId,
                    userEmoji: 'ü§ñ'
                });

                log('üì® –û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É: ' + currentRoomId);
            });

            socket.on('disconnect', () => {
                log('‚ùå –û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞', 'error');
            });

            socket.on('connect_error', (error) => {
                log('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ' + error.message, 'error');
            });

            // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤
            socket.on('room-players', (players) => {
                log('üë• –ü–æ–ª—É—á–µ–Ω —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤: ' + players.length + ' –∏–≥—Ä–æ–∫–æ–≤');

                players.forEach(player => {
                    log('  - ' + player.emoji + ' ' + player.name + ' (ID: ' + player.id + ')');
                });

                // –ù–∞—Ö–æ–¥–∏–º –¥—Ä—É–≥–æ–≥–æ –∏–≥—Ä–æ–∫–∞
                const otherPlayers = players.filter(p => p.id !== socket.id);
                if (otherPlayers.length > 0) {
                    otherSocketId = otherPlayers[0].id;
                    log('üéØ –ù–∞–π–¥–µ–Ω –¥—Ä—É–≥–æ–π –∏–≥—Ä–æ–∫: ' + otherSocketId);

                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                    setTimeout(() => {
                        log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏...');
                        socket.emit('send-game-invitation', {
                            roomId: currentRoomId,
                            targetPlayerId: otherSocketId,
                            gameType: 'tictactoe',
                            senderName: 'ü§ñ –¢–µ—Å—Ç–æ–≤—ã–π –∏–≥—Ä–æ–∫'
                        });
                    }, 1000);
                } else {
                    log('‚ö†Ô∏è –î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞.');
                }
            });

            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            socket.on('game-invitation', (data) => {
                log('üì® –ü–û–õ–£–ß–ï–ù–û –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ï! –û—Ç: ' + data.senderEmoji + ' ' + data.senderName, 'success');
                log('  –¢–∏–ø –∏–≥—Ä—ã: ' + data.gameType);
                log('  ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è: ' + data.senderId);

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–Ω–∏–º–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                setTimeout(() => {
                    log('‚úÖ –ü—Ä–∏–Ω–∏–º–∞–µ–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ...');
                    socket.emit('game-invitation-response', {
                        roomId: currentRoomId,
                        senderId: data.senderId,
                        accepted: true,
                        gameType: data.gameType
                    });
                }, 500);
            });

            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è
            socket.on('game-invitation-response', (data) => {
                if (data.accepted) {
                    log('‚úÖ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ! –ù–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É.', 'success');
                } else {
                    log('‚ùå –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ.', 'error');
                }
            });

            // –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å
            socket.on('game-started', (data) => {
                log('üéÆ –ò–ì–†–ê –ù–ê–ß–ê–õ–ê–°–¨! –¢–∏–ø: ' + data.gameType, 'success');
                log('  –ò–≥—Ä–æ–∫–∏: ' + data.players.join(', '));
                log('  –ö–æ–º–Ω–∞—Ç–∞: ' + data.roomId);
            });

            // –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
            socket.on('game-state', (state) => {
                log('üìä –ü–æ–ª—É—á–µ–Ω–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã: ' + state.gameType);
            });
        }

        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ"');
        };
    </script>
</body>
</html>

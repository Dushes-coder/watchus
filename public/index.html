<!doctype html>
<html lang="ru">

<head>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5" />
    <title>Watch Together</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <!-- IMMEDIATE REDIRECT FOR FILE PROTOCOL -->
    <script>
        if (window.location.protocol === 'file:') {
            window.location.href = 'http://localhost:3000';
        }
    </script>
    <noscript>
        <style>body { display: none; }</style>
        <meta http-equiv="refresh" content="0; url=http://localhost:3000">
    </noscript>
    
</head>

<body>
    <!-- Protocol Warning -->
    <div id="protocolWarning" class="protocol-warning" style="display: none;">
        <div class="warning-content">
            <h3>üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê</h3>
            <p style="color: #ff4444; font-weight: bold; font-size: 16px;">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ –ø—Ä–æ—Ç–æ–∫–æ–ª <code>file://</code></p>
            <p>Socket.IO –ù–ï –†–ê–ë–û–¢–ê–ï–¢ —Å file:// –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º. –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã:</p>
            <div style="background: var(--bg-tertiary); padding: 15px; border-radius: 8px; margin: 15px 0;">
                <p style="margin: 0; font-weight: bold;">1. –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω ‚úì</p>
                <p style="margin: 5px 0 0 0;">2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:</p>
                <p style="margin: 5px 0 0 0; font-size: 18px; font-weight: bold; color: var(--accent-primary);">http://localhost:3000</p>
            </div>
            <p id="redirectTimer" style="color: #ffaa00; font-weight: bold;">–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...</p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button onclick="window.location.href='http://localhost:3000'" style="background: var(--accent-primary);">–ü–µ—Ä–µ–π—Ç–∏ —Å–µ–π—á–∞—Å</button>
                <button onclick="this.parentElement.parentElement.parentElement.style.display='none'; document.getElementById('redirectTimer').textContent='–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç–º–µ–Ω—ë–Ω'" style="background: #666;">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>
    <div class="main-layout">
        <!-- Header Bar -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-left">
                    <div class="logo">
                        <span class="logo-icon">üé¨</span>
                        <span class="logo-text">Watch Together</span>
                    </div>
                </div>
                <div class="header-center">
                    <div class="connection-indicator">
                        <span class="connection-dot" id="headerConnectionDot"></span>
                        <span class="connection-label" id="headerConnectionLabel">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn camera-toggle" id="cameraToggle" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –≤–∏–¥–µ–æ—Å–≤—è–∑—å">
                        <span class="camera-icon">üìπ</span>
                    </button>
                    <button class="header-btn theme-toggle" id="themeToggle" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
                        <span class="theme-icon"></span>
                    </button>
                    <button class="header-btn about-btn" id="aboutBtn" title="–û –ø—Ä–æ–µ–∫—Ç–µ">
                        <span class="about-icon">‚ÑπÔ∏è</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Left Panel: Video Player & Chat -->
        <div class="left-panel">
            <!-- Video Player -->
            <div class="panel compact">
                <div id="playerContainer">
                    <div class="player-inner" id="playerInner"></div>
                </div>
                <div class="controls-bar">
                    <div class="control-group">
                        <button id="seekBack" class="secondary player-btn" aria-label="–ü–µ—Ä–µ–º–æ—Ç–∞—Ç—å –Ω–∞–∑–∞–¥">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5,12 19,21 19,3"></polygon>
                                <line x1="19" y1="12" x2="5" y2="12"></line>
                            </svg>
                        </button>
                        <button id="playPause" class="primary player-btn" aria-label="–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏/–ü–∞—É–∑–∞">
                            <svg id="playIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5,3 19,12 5,21"></polygon>
                            </svg>
                            <svg id="pauseIcon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                <rect x="6" y="4" width="4" height="16"></rect>
                                <rect x="14" y="4" width="4" height="16"></rect>
                            </svg>
                        </button>
                        <button id="seekFwd" class="secondary player-btn" aria-label="–ü–µ—Ä–µ–º–æ—Ç–∞—Ç—å –≤–ø–µ—Ä–µ–¥">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="19,12 5,21 5,3"></polygon>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                        </button>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                        <div class="progress-handle" id="progressHandle"></div>
                    </div>

                    <div class="control-group">
                        <div class="time-display">
                            <span id="time">0</span>
                            <span>—Å–µ–∫</span>
                        </div>

                        <div class="volume-control">
                            <button id="muteBtn" class="secondary" aria-label="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫">üîä</button>
                            <div class="volume-slider">
                                <div class="volume-slider-fill" id="volumeFill"></div>
                            </div>
                        </div>

                        <button class="speed-control" id="speedBtn">1x</button>
                    </div>
                </div>
            </div>
            <!-- Chat -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">üí¨</span>
                        <span>–ß–∞—Ç</span>
                    </div>
                </div>
                <div class="chat-container">
                    <div class="chat-messages" id="chatBox"></div>
                    <div class="chat-input-group">
                        <textarea id="chatMsg" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ..." rows="1"></textarea>
                        <button id="sendMsg" class="primary">‚û§</button>
                    </div>
                </div>
            </div>

            <!-- Room Settings -->
            <div class="panel compact">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">‚öôÔ∏è</span>
                        <span>–ö–æ–º–Ω–∞—Ç–∞</span>
                    </div>
                </div>
                <div class="room-settings">
                    <button id="openRoom" class="primary">üé¨ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–Ω–∞—Ç—ã</button>
                </div>
            </div>

            <!-- Active Game Panel -->
            <div id="activeGamePanel" class="panel game-panel hidden">
                <div class="panel-header">
                    <div class="panel-title">
                        <span id="activeGameIcon" class="icon">üéÆ</span>
                        <span id="activeGameTitle">–ò–≥—Ä–∞</span>
                    </div>
                    <button class="secondary icon-btn" onclick="closeGame()">‚úï</button>
                </div>
                <div id="activeGameContent"></div>
            </div>
        </div>

        <!-- Right Panel: Games -->
        <div class="right-panel">
            <!-- Games Section -->
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span class="icon">üéÆ</span>
                        <span>–ò–≥—Ä—ã</span>
                    </div>
                </div>
                <div id="gameContainer">
                    <h2>üéÆ –ò–≥—Ä—ã</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ –∏–≥—Ä—É –¥–ª—è –Ω–∞—á–∞–ª–∞:</p>

                    <div class="games-grid">
                        <div class="game-card" onclick="openGame('tictactoe')">
                            <div class="game-icon">‚≠ï</div>
                            <div class="game-title">–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏</div>
                            <div class="game-description">–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –∏–≥—Ä–∞ 3x3</div>
                        </div>

                        <div class="game-card" onclick="openGame('chess')">
                            <div class="game-icon">‚ôüÔ∏è</div>
                            <div class="game-title">–®–∞—Ö–º–∞—Ç—ã</div>
                            <div class="game-description">–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –∏–≥—Ä–∞</div>
                        </div>

                        <div class="game-card" onclick="openGame('cards')">
                            <div class="game-icon">üÉè</div>
                            <div class="game-title">–ö–∞—Ä—Ç–æ—á–Ω—ã–µ –∏–≥—Ä—ã</div>
                            <div class="game-description">–ü–æ–∫–µ—Ä –∏ –î—É—Ä–∞–∫</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Room Modal -->
    <div id="roomModal" class="modal-overlay" aria-hidden="true" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–Ω–∞—Ç—ã</h3>
                <button id="closeRoom" class="secondary icon-btn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
            </div>
            <div class="form-group">
                <label for="roomId">ID –∫–æ–º–Ω–∞—Ç—ã</label>
                <input id="roomId" type="text" placeholder="movie-night-123" />
            </div>
            <div class="form-group">
                <label for="videoUrl">–°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ</label>
                <input id="videoUrl" type="text" placeholder="https://example.com/video.mp4" />
                <p class="help-text">MP4, HLS (.m3u8), YouTube</p>
            </div>
            <div class="form-group">
                <label for="videoFile">–õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª</label>
                <input id="videoFile" type="file" accept="video/*,.m3u8" />
                <p class="help-text">‚ö†Ô∏è –í–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ –≤–∞–º</p>
            </div>
            <div class="form-actions">
                <button id="createBtn" class="primary">–í–æ–π—Ç–∏</button>
                <button id="copyInvite" class="secondary">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                <button id="resetSaved" class="secondary">üîÑ –°–±—Ä–æ—Å</button>
            </div>
        </div>
    </div>

    <!-- Floating Camera -->
    <div id="floatingCam" class="floating-cam">
        <div class="fc-header" id="camHeader">
            <span class="fc-header-title">üìπ –í–∏–¥–µ–æ—Å–≤—è–∑—å</span>
            <div class="fc-header-actions">
                <button id="toggleMic" class="secondary" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –º–∏–∫—Ä–æ—Ñ–æ–Ω">üé§</button>
                <button id="toggleCam" class="secondary" title="–í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∫–∞–º–µ—Ä—É">üì∑</button>
                <div class="volume-control">
                    <span class="volume-label">üîä</span>
                    <input type="range" id="remoteVolume" min="0" max="1" step="0.1" value="1" class="volume-slider" title="–ì—Ä–æ–º–∫–æ—Å—Ç—å –≤–∏–¥–µ–æ—Å–≤—è–∑–∏">
                </div>
                <button id="pipBtn" class="secondary" title="Picture-in-Picture">üóî</button>
                <button id="toggleSelf" class="secondary" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Å–µ–±—è">üë§</button>
            </div>
        </div>
        <div class="fc-body">
            <video id="localVideo" autoplay muted playsinline></video>
            <video id="remoteVideo" autoplay playsinline></video>
        </div>
        <div class="resize-handle rh-right"></div>
        <div class="resize-handle rh-bottom"></div>
        <div class="resize-handle rh-corner"></div>
    </div>

    <!-- About Modal -->
    <div id="aboutModal" class="modal-overlay" aria-hidden="true" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–û –ø—Ä–æ–µ–∫—Ç–µ Watch Together</h3>
                <button id="closeAbout" class="secondary icon-btn" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
            </div>
            <div class="about-content">
                <div class="about-hero">
                    <div class="logo-large">
                        <span class="logo-icon-large">üé¨</span>
                        <h2>Watch Together</h2>
                    </div>
                    <p class="about-description">
                        –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ —Å –¥—Ä—É–∑—å—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
                        –ò–≥—Ä–∞–π—Ç–µ –≤ –∏–≥—Ä—ã, –æ–±—â–∞–π—Ç–µ—Å—å –≤ —á–∞—Ç–µ –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞.
                    </p>
                </div>
                
                <div class="about-features">
                    <div class="feature-grid">
                        <div class="feature-item">
                            <div class="feature-icon">üé•</div>
                            <h4>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤–∏–¥–µ–æ</h4>
                            <p>–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –≤–∏–¥—è—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ –≤–∏–¥–µ–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üí¨</div>
                            <h4>–ß–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h4>
                            <p>–û–±—â–∞–π—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏ –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üéÆ</div>
                            <h4>–ú–∏–Ω–∏-–∏–≥—Ä—ã</h4>
                            <p>–ò–≥—Ä–∞–π—Ç–µ –≤ –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏, —à–∞—Ö–º–∞—Ç—ã –∏ –∫–∞—Ä—Ç–æ—á–Ω—ã–µ –∏–≥—Ä—ã</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üìπ</div>
                            <h4>–í–∏–¥–µ–æ—Å–≤—è–∑—å</h4>
                            <p>–í–∫–ª—é—á–∞–π—Ç–µ –∫–∞–º–µ—Ä—É –¥–ª—è –æ–±—â–µ–Ω–∏—è –ª–∏—Ü–æ–º –∫ –ª–∏—Ü—É</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üîí</div>
                            <h4>–ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã</h4>
                            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –∫–æ–º–Ω–∞—Ç—ã –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">üì±</div>
                            <h4>–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</h4>
                            <p>–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö –æ—Ç —Å–º–∞—Ä—Ç—Ñ–æ–Ω–æ–≤ –¥–æ 4K –¥–∏—Å–ø–ª–µ–µ–≤</p>
                        </div>
                    </div>
                </div>
                
                <div class="about-tech">
                    <h4>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h4>
                    <div class="tech-stack">
                        <span class="tech-badge">WebRTC</span>
                        <span class="tech-badge">Socket.IO</span>
                        <span class="tech-badge">HLS.js</span>
                        <span class="tech-badge">HTML5 Video</span>
                        <span class="tech-badge">CSS Grid</span>
                        <span class="tech-badge">JavaScript ES6+</span>
                    </div>
                </div>
                
                <div class="about-footer">
                    <p>–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –ª—é–±–∏—Ç–µ–ª–µ–π –∫–∏–Ω–æ –∏ –∏–≥—Ä</p>
                    <p class="version">–í–µ—Ä—Å–∏—è 1.0.0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Warning -->
    <div id="mobileWarning" class="mobile-warning" style="display: none;">
        <div class="warning-content">
            <h3>üì± –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</h3>
            <p>–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö:</p>
            <ul style="text-align: left;">
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä –≤ –æ–¥–Ω–æ–π Wi-Fi —Å–µ—Ç–∏</li>
                <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ IP-–∞–¥—Ä–µ—Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ –≤–º–µ—Å—Ç–æ localhost</li>
                <li>–ù–∞–ø—Ä–∏–º–µ—Ä: <code>http://192.168.1.100:3000</code></li>
                <li>–ò–ª–∏: <code>http://[IP-–∫–æ–º–ø—å—é—Ç–µ—Ä–∞]:3000</code></li>
            </ul>
            <p><small>–ö–∞–º–µ—Ä–∞ –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ –Ω–∞–∂–∞—Ç–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞</small></p>
            <button onclick="this.parentElement.parentElement.style.display='none'">–ü–æ–Ω—è—Ç–Ω–æ</button>
        </div>
    </div>

    <script src="socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.1/dist/hls.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="network-utils.js"></script>
    <script src="client.js"></script>
    <script src="games.js"></script>
    <script>
        // Debug information
        console.log('Page protocol:', window.location.protocol);
        console.log('Page origin:', window.location.origin);
        console.log('Socket.IO loaded:', typeof io !== 'undefined');

        // FORCE redirect if opened via file:// protocol
        if (window.location.protocol === 'file:') {
            // Show warning immediately
            const warning = document.getElementById('protocolWarning');
            if (warning) {
                warning.style.display = 'flex';
            }

            // Countdown timer
            let countdown = 10;
            const timerElement = document.getElementById('redirectTimer');
            const countdownInterval = setInterval(() => {
                countdown--;
                if (timerElement) {
                    timerElement.textContent = `–ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ ${countdown} —Å–µ–∫—É–Ω–¥...`;
                }
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    if (window.location.protocol === 'file:') {
                        console.log('Auto-redirecting to http://localhost:3000');
                        window.location.href = 'http://localhost:3000';
                    }
                }
            }, 1000);

            // Prevent any socket initialization
            window.initializeSocket = function() {
                console.warn('Socket initialization blocked - please use http://localhost:3000');
            };
        } else {
            // Check if user is on mobile and accessing via localhost
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile && window.location.hostname === 'localhost') {
                // Show mobile warning
                const mobileWarning = document.getElementById('mobileWarning');
                if (mobileWarning) {
                    mobileWarning.style.display = 'flex';

                    // Try to get local IP for better instructions
                    fetch('https://api.ipify.org?format=json')
                        .then(response => response.json())
                        .then(data => {
                            // This gets external IP, but we can suggest using network tools
                            console.log('External IP detected:', data.ip);
                        })
                        .catch(() => {
                            console.log('Could not detect external IP');
                        });

                    setTimeout(() => {
                        mobileWarning.style.display = 'none';
                    }, 8000); // Hide after 8 seconds
                }
            }

            console.log('Protocol OK, initializing socket...');
        }
    </script>
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Ö–µ–¥–µ—Ä–µ
        function updateHeaderConnectionStatus() {
            const headerDot = document.getElementById('headerConnectionDot');
            const headerLabel = document.getElementById('headerConnectionLabel');
            const statusEl = document.getElementById('connectionStatus');

            if (!headerDot || !headerLabel || !statusEl) return;

            const isConnected = statusEl.classList.contains('connected');
            const isDisconnected = statusEl.classList.contains('disconnected');

            if (isConnected) {
                headerDot.className = 'connection-dot connected';
                headerLabel.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–æ';
            } else if (isDisconnected) {
                headerDot.className = 'connection-dot disconnected';
                headerLabel.textContent = '–ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è';
            } else {
                headerDot.className = 'connection-dot';
                headerLabel.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            if (themeToggle) {
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Ç–µ–º—É
                try {
                    const savedTheme = localStorage.getItem('wt_theme');
                    if (savedTheme === 'light') {
                        document.body.classList.add('light-theme');
                        const themeIcon = themeToggle.querySelector('.theme-icon');
                        if (themeIcon) themeIcon.textContent = 'üåô';
                    } else {
                        const themeIcon = themeToggle.querySelector('.theme-icon');
                        if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
                    }
                } catch (e) {}

                themeToggle.addEventListener('click', function() {
                    const body = document.body;
                    const isLight = body.classList.contains('light-theme');
                    const themeIcon = this.querySelector('.theme-icon');

                    if (isLight) {
                        body.classList.remove('light-theme');
                        body.classList.add('theme-transition');
                        try { localStorage.setItem('wt_theme', 'dark'); } catch (e) {}
                        if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
                    } else {
                        body.classList.add('light-theme', 'theme-transition');
                        try { localStorage.setItem('wt_theme', 'light'); } catch (e) {}
                        if (themeIcon) themeIcon.textContent = 'üåô';
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ —Ö–µ–¥–µ—Ä–µ
                    setTimeout(updateHeaderConnectionStatus, 50);

                    // –£–¥–∞–ª—è–µ–º –∫–ª–∞—Å—Å –∞–Ω–∏–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ 300ms
                    setTimeout(() => {
                        body.classList.remove('theme-transition');
                    }, 300);
                });
            }
        });
    </script>
</body>
</html>
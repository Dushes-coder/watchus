# Watch Together ‚Äî –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

## üìã –û–±–∑–æ—Ä

–ü—Ä–æ–µ–∫—Ç **Watch Together** ‚Äî —ç—Ç–æ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤–∏–¥–µ–æ —Å –¥—Ä—É–∑—å—è–º–∏, –≤–∫–ª—é—á–∞—é—â–µ–µ:
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤–∏–¥–µ–æ–ø–ª–µ–µ—Ä–∞ (HTML5, HLS, YouTube)
- –ß–∞—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- WebRTC –≤–∏–¥–µ–æ—Å–≤—è–∑—å
- –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –∏–≥—Ä—ã (—à–∞—Ö–º–∞—Ç—ã, –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏, –∫–∞—Ä—Ç—ã)

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
watch_together/
‚îú‚îÄ‚îÄ server.js                 # Node.js —Å–µ—Ä–≤–µ—Ä (Express + Socket.IO)
‚îú‚îÄ‚îÄ package.json              # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ README.md                 # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
‚îú‚îÄ‚îÄ INTEGRATION_GUIDE.md      # –≠—Ç–æ—Ç —Ñ–∞–π–ª ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ public/                   # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç–∞
    ‚îú‚îÄ‚îÄ index.html            # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (HTML —Ä–∞–∑–º–µ—Ç–∫–∞)
    ‚îú‚îÄ‚îÄ styles.css            # –í—Å–µ —Å—Ç–∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ client.js             # –û—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞
    ‚îî‚îÄ‚îÄ games.js              # –õ–æ–≥–∏–∫–∞ –∏–≥—Ä (—à–∞—Ö–º–∞—Ç—ã, –∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏, –∫–∞—Ä—Ç—ã)
```

---

## üîó –ö–∞–∫ —Ñ–∞–π–ª—ã —Å–≤—è–∑–∞–Ω—ã –º–µ–∂–¥—É —Å–æ–±–æ–π

### 1. **index.html** ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç —à—Ä–∏—Ñ—Ç—ã Google Fonts (Inter)
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç `styles.css` –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:
  - `socket.io/socket.io.js` ‚Äî Socket.IO –∫–ª–∏–µ–Ω—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–∞—ë—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º)
  - `hls.js` ‚Äî –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è HLS-–ø–æ—Ç–æ–∫–æ–≤ (.m3u8)
  - YouTube IFrame API ‚Äî –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è YouTube-–ø–ª–µ–µ—Ä–∞
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è **–≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ**:
  1. `client.js` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ (–ø–ª–µ–µ—Ä, —á–∞—Ç, WebRTC)
  2. `games.js` ‚Äî –ª–æ–≥–∏–∫–∞ –∏–≥—Ä

**–í–∞–∂–Ω–æ:** –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏ `<script>`, –±–µ–∑ ES-–º–æ–¥—É–ª–µ–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å CORS –∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é.

---

### 2. **styles.css** ‚Äî –µ–¥–∏–Ω—ã–π —Ñ–∞–π–ª —Å—Ç–∏–ª–µ–π
–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ CSS-–ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è:
- –û—Å–Ω–æ–≤–Ω–æ–≥–æ –º–∞–∫–µ—Ç–∞ (`.main-layout`, `.left-panel`, `.right-panel`)
- –ü–∞–Ω–µ–ª–µ–π –∏ –∫–∞—Ä—Ç–æ—á–µ–∫ (`.panel`, `.panel-header`)
- –í–∏–¥–µ–æ–ø–ª–µ–µ—Ä–∞ (`#playerContainer`, `.controls-bar`)
- –ß–∞—Ç–∞ (`.chat-container`, `.chat-messages`)
- –ò–≥—Ä (`.chess-board`, `.ttt-board`, `.cards-container`)
- –ü–ª–∞–≤–∞—é—â–µ–π –∫–∞–º–µ—Ä—ã (`.floating-cam`)
- –ú–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω (`.modal-overlay`)

**CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** (`:root`) –∑–∞–¥–∞—é—Ç —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É –∏ –æ—Ç—Å—Ç—É–ø—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ.

---

### 3. **client.js** ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ª–æ–≥–∏–∫–∞

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Socket.IO —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ** (`const socket = io()`)
- **–£–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∏–¥–µ–æ–ø–ª–µ–µ—Ä–æ–º**:
  - HTML5 `<video>` (–≤–∫–ª—é—á–∞—è HLS —á–µ—Ä–µ–∑ hls.js)
  - YouTube —á–µ—Ä–µ–∑ YouTube IFrame API
  - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç play/pause/seek –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —á–∞—Ç**: –æ—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- **WebRTC –≤–∏–¥–µ–æ—Å–≤—è–∑—å**: —Å–æ–∑–¥–∞–Ω–∏–µ peer connections, –æ–±–º–µ–Ω SDP/ICE
- **–ü–ª–∞–≤–∞—é—â–∞—è –∫–∞–º–µ—Ä–∞**: drag-and-drop, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞, PiP
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**: localStorage –¥–ª—è roomId, videoUrl, –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞–º–µ—Ä—ã

#### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤:
```javascript
window.socket = socket;        // –î–æ—Å—Ç—É–ø –∫ Socket.IO –∏–∑ games.js
window.roomId = roomId;        // –¢–µ–∫—É—â–∞—è –∫–æ–º–Ω–∞—Ç–∞ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ updateGlobalRoomId)
```

#### –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π:
1. DOM –∑–∞–≥—Ä—É–∂–µ–Ω ‚Üí –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
2. –ê–≤—Ç–æ-–≤—Ö–æ–¥ –ø–æ URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º (`?room=...&url=...`)
3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–ª–∞–≤–∞—é—â–µ–π –∫–∞–º–µ—Ä—ã –∏ PiP

---

### 4. **games.js** ‚Äî –ª–æ–≥–∏–∫–∞ –∏–≥—Ä

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- **–†–µ–∞–ª–∏–∑—É–µ—Ç —Ç—Ä–∏ –∏–≥—Ä—ã**:
  - **–®–∞—Ö–º–∞—Ç—ã** (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ö–æ–¥–æ–≤)
  - **–ö—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏**
  - **–ö–∞—Ä—Ç—ã** (–∏–≥—Ä–∞ "–î—É—Ä–∞–∫" ‚Äî –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
- **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ client.js**:
  - `window.socket` ‚Äî –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  - `window.roomId` ‚Äî –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–º–Ω–∞—Ç—ã
  - `window.chessPieces` ‚Äî Unicode-—Å–∏–º–≤–æ–ª—ã —à–∞—Ö–º–∞—Ç–Ω—ã—Ö —Ñ–∏–≥—É—Ä
- **–†–µ–Ω–¥–µ—Ä–∏—Ç –∏–≥—Ä—ã –≤ `#gameContainer`** (–≤–Ω—É—Ç—Ä–∏ `#activeGamePanel`)
- **–û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏** (`#activeGameIcon`, `#activeGameTitle`)

#### –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
```javascript
window.openGame = openGame;    // –û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä—É (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ onclick –≤ HTML)
window.closeGame = closeGame;  // –ó–∞–∫—Ä—ã—Ç—å –∏–≥—Ä—É
```

#### CSS-–∫–ª–∞—Å—Å—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ games.js:
- `.chess-board`, `.chess-cell` (—à–∞—Ö–º–∞—Ç—ã)
- `.ttt-board`, `.ttt-cell` (–∫—Ä–µ—Å—Ç–∏–∫–∏-–Ω–æ–ª–∏–∫–∏)
- `.cards-container`, `.cards-table`, `.cards-hand`, `.card` (–∫–∞—Ä—Ç—ã)

---

### 5. **server.js** ‚Äî Node.js —Å–µ—Ä–≤–µ—Ä

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
- **Express**: —Ä–∞–∑–¥–∞—ë—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏–∑ `public/`
- **Socket.IO**: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
  - `join-room` ‚Äî –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
  - `player-event` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–ª–µ–µ—Ä–∞ (play/pause/seek/load)
  - `load-video` ‚Äî —Å–º–µ–Ω–∞ –≤–∏–¥–µ–æ
  - `chat-message` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç
  - `webrtc-offer`, `webrtc-answer`, `webrtc-ice` ‚Äî WebRTC-—Å–∏–≥–Ω–∞–ª–∏–∑–∞—Ü–∏—è
  - `chess-move`, `game_event` ‚Äî –∏–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è (–ø–æ–∫–∞ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é)
- **–•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç** –≤ –ø–∞–º—è—Ç–∏ (`roomStates` Map)

#### –ó–∞–ø—É—Å–∫:
```bash
npm install
npm start
```
–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ `http://localhost:3000`

---

## üîÑ –ü–æ—Ä—è–¥–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

### –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:

1. **–ë—Ä–∞—É–∑–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç `index.html`**
2. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `styles.css`** ‚Üí –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Å—Ç–∏–ª–∏
3. **–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–Ω–µ—à–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**:
   - Socket.IO –∫–ª–∏–µ–Ω—Ç
   - hls.js
   - YouTube IFrame API
4. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `client.js`**:
   - –°–æ–∑–¥–∞—ë—Ç—Å—è Socket.IO —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
   - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è `window.socket`, `window.roomId`
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ UI
5. **–ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `games.js`**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `window.socket` –∏ `window.roomId` –∏–∑ `client.js`
   - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `window.openGame`, `window.closeGame`
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `window.chessPieces`

### –ü—Ä–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

#### –í—Ö–æ–¥ –≤ –∫–æ–º–Ω–∞—Ç—É:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `roomId` –∏ `videoUrl`
2. `client.js` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `join-room` –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. –°–µ—Ä–≤–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–º–Ω–∞—Ç—É Socket.IO
4. –°–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã (`room-state`)
5. `client.js` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–∏–¥–µ–æ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –≤—Ä–µ–º—è

#### –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–ª–µ–µ—Ä–∞:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç Play/Pause/Seek
2. `client.js` –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `player-event` –Ω–∞ —Å–µ—Ä–≤–µ—Ä
3. –°–µ—Ä–≤–µ—Ä —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤—Å–µ–º –≤ –∫–æ–º–Ω–∞—Ç–µ (–∫—Ä–æ–º–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è)
4. –î—Ä—É–≥–∏–µ –∫–ª–∏–µ–Ω—Ç—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ `applyIncomingEvent()`

#### –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–≥—Ä—ã:
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –∏–≥—Ä—ã (`onclick="openGame('chess')"`)
2. `games.js` ‚Üí `openGame()`:
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç `#activeGamePanel`
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏
   - –†–µ–Ω–¥–µ—Ä–∏—Ç –∏–≥—Ä—É –≤ `#gameContainer`
3. –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `window.socket.emit()`

---

## üé® CSS-–∫–ª–∞—Å—Å—ã –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
- `.main-layout` ‚Äî —Å–µ—Ç–∫–∞ 2 –∫–æ–ª–æ–Ω–∫–∏ (–≤–∏–¥–µ–æ + —á–∞—Ç)
- `.left-panel` ‚Äî –ª–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (–ø–ª–µ–µ—Ä + –∏–≥—Ä—ã)
- `.right-panel` ‚Äî –ø—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ (—á–∞—Ç + –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

### –ü–∞–Ω–µ–ª–∏:
- `.panel` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ —Å —Ñ–æ–Ω–æ–º –∏ —Ç–µ–Ω—å—é
- `.panel-header` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏
- `.panel-title` ‚Äî —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Å –∏–∫–æ–Ω–∫–æ–π

### –ü–ª–µ–µ—Ä:
- `#playerContainer` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–ª–µ–µ—Ä–∞ (aspect-ratio 16:9)
- `.player-inner` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è `<video>` –∏–ª–∏ `<iframe>`
- `.controls-bar` ‚Äî –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (play/pause/seek)

### –ß–∞—Ç:
- `.chat-container` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–∞—Ç–∞
- `.chat-messages` (id: `chatBox`) ‚Äî —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π
- `.chat-input-group` ‚Äî –ø–æ–ª–µ –≤–≤–æ–¥–∞ + –∫–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
- `.message` ‚Äî –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ

### –ò–≥—Ä—ã:
- `#activeGamePanel` ‚Äî –ø–∞–Ω–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ–π –∏–≥—Ä—ã
- `#gameContainer` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∞ –∏–≥—Ä—ã
- `.chess-board`, `.chess-cell` ‚Äî —à–∞—Ö–º–∞—Ç–Ω–∞—è –¥–æ—Å–∫–∞
- `.ttt-board`, `.ttt-cell` ‚Äî –ø–æ–ª–µ –∫—Ä–µ—Å—Ç–∏–∫–æ–≤-–Ω–æ–ª–∏–∫–æ–≤
- `.cards-container`, `.cards-table`, `.cards-hand`, `.card` ‚Äî –∫–∞—Ä—Ç–æ—á–Ω–∞—è –∏–≥—Ä–∞

### –ü–ª–∞–≤–∞—é—â–∞—è –∫–∞–º–µ—Ä–∞:
- `.floating-cam` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞–º–µ—Ä—ã (draggable, resizable)
- `.fc-header` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è)
- `.fc-body` ‚Äî –≤–∏–¥–µ–æ (localVideo + remoteVideo)
- `.fc-footer` ‚Äî –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞:
- `.modal-overlay` ‚Äî –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω —Å —Ä–∞–∑–º—ã—Ç–∏–µ–º
- `.modal-content` ‚Äî —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø–æ—è–≤–ª–µ–Ω–∏—è
- `.modal-header` ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π –∑–∞–∫—Ä—ã—Ç–∏—è
- `.form-actions` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π

---

## üõ†Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. **–£–¥–∞–ª–µ–Ω—ã –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ ES-–∏–º–ø–æ—Ä—Ç—ã**
**–ë—ã–ª–æ:**
```javascript
import 'public/games.js';  // ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ bundler
import './videoPlayer.js'; // ‚ùå –§–∞–π–ª—ã –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
```
**–°—Ç–∞–ª–æ:**
```html
<!-- –í index.html –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏ -->
<script src="client.js"></script>
<script src="games.js"></script>
```

### 2. **–≠–∫—Å–ø–æ—Ä—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö**
**client.js:**
```javascript
window.socket = socket;              // –î–æ—Å—Ç—É–ø –∫ Socket.IO –∏–∑ games.js
window.roomId = roomId;              // –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ updateGlobalRoomId()
```

**games.js:**
```javascript
```
**–°—Ç–∞–ª–æ:**
```javascript
const container = document.getElementById('gameContainer');
container.innerHTML = html; // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏
```

### 5. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è window.roomId**
–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `updateGlobalRoomId()`, –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏:
- –í—Ö–æ–¥–µ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
- –ê–≤—Ç–æ-–≤—Ö–æ–¥–µ –ø–æ URL-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–∑ localStorage

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (package.json)

```json
{
  "name": "watch-together-prototype",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "socket.io": "^4.7.2"
  }
}
```

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
npm install
```

### 2. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞:
```bash
npm start
```

### 3. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
```
http://localhost:3000
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
- –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–µ –≤–∫–ª–∞–¥–∫–∏
- –í –æ–±–µ–∏—Ö –≤–≤–µ–¥–∏—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π `Room ID` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `test-room`)
- –í—Å—Ç–∞–≤—å—Ç–µ URL –≤–∏–¥–µ–æ (MP4, HLS –∏–ª–∏ YouTube)
- –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏" –≤ –æ–±–µ–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- –£–ø—Ä–∞–≤–ª—è–π—Ç–µ –ø–ª–µ–µ—Ä–æ–º –≤ –æ–¥–Ω–æ–π –≤–∫–ª–∞–¥–∫–µ ‚Üí –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∑—è—Ç—Å—è –≤ –¥—Ä—É–≥–æ–π

---

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–≥—Ä

### –û—Ç–∫—Ä—ã—Ç–∏–µ –∏–≥—Ä—ã:
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É –∏–≥—Ä—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "–ò–≥—Ä—ã"
2. –ò–≥—Ä–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –ø–∞–Ω–µ–ª–∏ `#activeGamePanel`
3. –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–∞–Ω–µ–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—Å—è (–∏–∫–æ–Ω–∫–∞ + –Ω–∞–∑–≤–∞–Ω–∏–µ)

### –ó–∞–∫—Ä—ã—Ç–∏–µ –∏–≥—Ä—ã:
- –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–ó–∞–∫—Ä—ã—Ç—å" –≤–Ω—É—Ç—Ä–∏ –∏–≥—Ä—ã
- –ò–ª–∏ –∫–Ω–æ–ø–∫—É "‚úï" –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –ø–∞–Ω–µ–ª–∏

### –ò–≥—Ä–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è:
- –•–æ–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `window.socket.emit()`
- –°–µ—Ä–≤–µ—Ä –º–æ–∂–µ—Ç —Ä–µ—Ç—Ä–∞–Ω—Å–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º (—Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∞ server.js)

---

## üîß –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å:
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–≥—Ä–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π (`chess-move`, `game_event`)
- [ ] –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (Redis/PostgreSQL) –≤–º–µ—Å—Ç–æ in-memory Map
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å:
- [ ] –ü–æ–ª–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–≥—Ä –º–µ–∂–¥—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [ ] –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ —à–∞—Ö–º–∞—Ç (–ø—Ä–æ–≤–µ—Ä–∫–∞ —à–∞—Ö–∞/–º–∞—Ç–∞, —Ä–æ–∫–∏—Ä–æ–≤–∫–∞, –≤–∑—è—Ç–∏–µ –Ω–∞ –ø—Ä–æ—Ö–æ–¥–µ)
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö peer connections –¥–ª—è WebRTC (—Å–µ–π—á–∞—Å —Ç–æ–ª—å–∫–æ 1-–Ω–∞-1)
- [ ] –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –≤—ë—Ä—Å—Ç–∫–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- [ ] –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞
- [ ] –ó–∞–ø–∏—Å—å –≤–∏–¥–µ–æ–∑–≤–æ–Ω–∫–æ–≤
- [ ] –ü–ª–µ–π–ª–∏—Å—Ç—ã –≤–∏–¥–µ–æ
- [ ] –ë–æ–ª—å—à–µ –∏–≥—Ä (—à–∞—à–∫–∏, –ø–æ–∫–µ—Ä, –∏ —Ç.–¥.)

---

## üìù –ò—Ç–æ–≥–æ–≤–∞—è –∫–∞—Ä—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
index.html
  ‚îú‚îÄ styles.css (—Å—Ç–∏–ª–∏)
  ‚îú‚îÄ socket.io/socket.io.js (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
  ‚îú‚îÄ hls.js (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
  ‚îú‚îÄ YouTube IFrame API (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞)
  ‚îú‚îÄ client.js
  ‚îÇ   ‚îú‚îÄ –°–æ–∑–¥–∞—ë—Ç window.socket
  ‚îÇ   ‚îú‚îÄ –°–æ–∑–¥–∞—ë—Ç window.roomId
  ‚îÇ   ‚îî‚îÄ –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–µ–µ—Ä–æ–º, —á–∞—Ç–æ–º, WebRTC
  ‚îî‚îÄ games.js
      ‚îú‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç window.socket
      ‚îú‚îÄ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç window.roomId
      ‚îú‚îÄ –°–æ–∑–¥–∞—ë—Ç window.openGame
      ‚îú‚îÄ –°–æ–∑–¥–∞—ë—Ç window.closeGame
      ‚îî‚îÄ –°–æ–∑–¥–∞—ë—Ç window.chessPieces

server.js
  ‚îú‚îÄ –†–∞–∑–¥–∞—ë—Ç public/ —á–µ—Ä–µ–∑ Express
  ‚îú‚îÄ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç Socket.IO —Å–æ–±—ã—Ç–∏—è
  ‚îî‚îÄ –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–Ω–∞—Ç (roomStates)
```

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ **Watch Together** —Ç–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã:
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ CSS-–∫–ª–∞—Å—Å—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ä–∞–∑–º–µ—Ç–∫–µ
- ‚úÖ –ò–≥—Ä—ã —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
- ‚úÖ –õ–æ–≥–∏–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –∑–∞–ø—É—Å–∫—É –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ
